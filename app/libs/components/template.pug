mixin text(name, root)
    p #{name}
        textarea(type="text" name=name ng-model=root+name)

mixin youtube(name, root)
    p #{name} (youtube url)
        input(type="url" name=name ng-model=root+name)

mixin img(name, root)
    p IMG #{name}
        img(data-ng-src="data:{{"+root+name+".filetype}};base64,{{"+root+name+".base64}}" data-err-src="images/png/avatar.png")
        //TODO img error
        input(type="file" accept="image/*" ng-model=root+name required base-sixty-four-input)
        //TODO validations

mixin array(name, value, root, level, remove)
    - tag = "h"+ (level+1)
    if name == ''
        - root = root.slice(0,-1)
    - val = value[0]
    //TODO do some checks
    if val instanceof Array
        - addValue = "[]"
    else if typeof (val) == 'object'
        - addValue = "{}"
    div(class=panel(level))
        .panel-heading
            #{tag} Array of data #{name}
        .panel-body
            button(ng-click=root + name+".push("+addValue+")") Add element
            div("ng-repeat"='(key'+level+',value'+level+') in '+root + name)
                if val instanceof Array
                    +array('', val, root+name+'[key'+level+'].', level+1, root + name+".remove(key"+level+")") //TODO do a better name
                else if typeof (val) == 'object'
                    +object('', val,root+name+'[key'+level+'].', level+1, root + name+".remove(key"+level+")")
            if remove != ''
                button(ng-click=remove) Remove

mixin object(name, obj, root, level, remove)
    - tag = "h"+ (level+1)
    div(class=panel(level))
        if name != ''
            .panel-heading
                #{tag} #{name}
        .panel-body
            each val, index in obj
                if val instanceof Array
                    +array(index, val, root, level+1, '')
                else if typeof (val) == 'object'
                    +object(index, val, root+index+'.', level+1, '')
                else if val == "text"
                    +text(index, root)
                else if val == "youtube"
                    +youtube(index, root)
                else if val == "img"
                    +img(index, root)
            if remove != ''
                button(ng-click=remove) Remove

- function panel(level){
-     if(level == 0){
-         return "panel-primary panel";
-     }else if(level == 1){
-         return "panel-success panel";
-     }else if(level == 2){
-         return "panel-info panel";
-     }else if(level == 3){
-         return "panel-warning.panel panel";
-     }else{
-         return "panel-default panel";
-     }
- }


.panel-group
    +object('Main Data', structure, 'status.data.', 0, '')

script(type='text/javascript').
    Array.prototype.remove = function (from, to) {
        var rest = this.slice((to || from) + 1 || this.length);
        this.length = from < 0 ? this.length + from : from;
        return this.push.apply(this, rest);
    };